# 二重権限ログインシステム ガイド

## 概要

特定のユーザーに教師・生徒両方の権限を付与し、ログイン方式によって画面を分岐させるシステムを実装しました。

## 対象ユーザー

以下の3名のユーザーが教師・生徒両方の権限を持ちます：

### 1. Ikki Yamamoto
- **メールアドレス**: `ikki_y0518@icloud.com`
- **教師ID**: `TC-0001`
- **パスワード**: `ikki0518`

### 2. Minna User
- **メールアドレス**: `minnanoakogare777@gmail.com`
- **教師ID**: `TC-0002`
- **パスワード**: `minna777`

### 3. Shishan User
- **メールアドレス**: `shishanxintai20@gmail.com`
- **教師ID**: `TC-0003`
- **パスワード**: `shishan20`

## ログイン方式と画面分岐

### 🎓 学生権限でログイン（メールアドレス使用）
```
ログイン方法: メールアドレス + パスワード
画面遷移: 学習管理画面（カレンダー、タスク管理など）
権限: 学習記録の閲覧・編集、課題の提出
```

**例:**
- ユーザーID: `ikki_y0518@icloud.com`
- パスワード: `ikki0518`
- 結果: 学生として学習管理画面にアクセス

### 👨‍🏫 教師権限でログイン（教師ID使用）
```
ログイン方法: 教師ID + パスワード
画面遷移: 教師管理画面（生徒管理、課題作成など）
権限: 課題の作成・管理、生徒の学習状況確認、メッセージ送信
```

**例:**
- ユーザーID: `TC-0001`
- パスワード: `ikki0518`
- 結果: 教師として管理画面にアクセス

## データベース構造

### プロファイルテーブル
各ユーザーは2つのプロファイルを持ちます：

#### 学生プロファイル
```sql
-- 例: Ikki の学生プロファイル
user_id: PM-0100 (既存)
email: ikki_y0518@icloud.com
name: Ikki Yamamoto (学生)
role: STUDENT
tenant_code: PM
```

#### 教師プロファイル
```sql
-- 例: Ikki の教師プロファイル
user_id: TC-0001
email: ikki_y0518@icloud.com
name: Ikki Teacher
role: TEACHER
tenant_code: TC
```

## 実装詳細

### LoginScreen.jsx の変更点

1. **ログイン方式の自動判定**
   ```javascript
   const isUserId = userIdGenerator.validateUserIdFormat(formData.loginField);
   const isEmail = /\S+@\S+\.\S+/.test(formData.loginField);
   ```

2. **メールアドレスログイン（学生権限）**
   ```javascript
   if (formData.loginField === 'ikki_y0518@icloud.com' && formData.password === 'ikki0518') {
     // 学生権限でログイン
     userRole: 'STUDENT'
   }
   ```

3. **教師IDログイン（教師権限）**
   ```javascript
   if (formData.loginField === 'TC-0001' && formData.password === 'ikki0518') {
     // 教師権限でログイン
     userRole: 'INSTRUCTOR'
   }
   ```

### セキュリティ機能

- **多層認証システム**: localStorage、sessionStorage、Cookieの3重保存
- **セッション管理**: 自動ログアウト機能
- **権限分離**: 教師と学生で完全に分離されたデータアクセス

## 使用方法

### 学生として利用する場合
1. ログイン画面でメールアドレスを入力
2. パスワードを入力
3. 「ログイン」ボタンをクリック
4. 学習管理画面にリダイレクト

### 教師として利用する場合
1. ログイン画面で教師ID（TC-0001など）を入力
2. 同じパスワードを入力
3. 「ログイン」ボタンをクリック
4. 教師管理画面にリダイレクト

## テスト方法

### 1. 学生権限のテスト
```
URL: http://localhost:3000
ログイン: ikki_y0518@icloud.com / ikki0518
期待結果: 学習カレンダー画面が表示される
```

### 2. 教師権限のテスト
```
URL: http://localhost:3000
ログイン: TC-0001 / ikki0518
期待結果: 教師管理画面が表示される
```

### 3. 権限切り替えテスト
```
1. 学生でログイン → ログアウト
2. 教師IDでログイン → 画面が切り替わることを確認
3. ログアウト → 学生でログイン → 画面が切り替わることを確認
```

## トラブルシューティング

### ログインできない場合
1. **入力形式の確認**
   - メールアドレス: `@`マークが含まれているか
   - 教師ID: `TC-0001`形式になっているか

2. **パスワードの確認**
   - 大文字小文字を正確に入力
   - 特殊文字の入力ミスがないか

3. **ブラウザキャッシュのクリア**
   - localStorage、sessionStorageをクリア
   - ブラウザを再起動

### 権限が正しく表示されない場合
1. **ログアウト後の再ログイン**
2. **ブラウザの開発者ツールでlocalStorageを確認**
3. **コンソールログでユーザー情報を確認**

## 今後の拡張

- **ワンクリック権限切り替え**: ログイン後に権限を切り替える機能
- **統合ダッシュボード**: 両方の権限を同時に表示する画面
- **権限履歴**: どちらの権限でログインしたかの履歴管理